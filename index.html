<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miami Beach Resort - Front Desk</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); min-height: 100vh; color: white; }
        
        /* Glass morphism */
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .glass-dark { background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        
        /* Sticky header */
        .sticky-header { position: sticky; top: 0; z-index: 100; background: linear-gradient(180deg, #0f172a 0%, rgba(15,23,42,0.95) 100%); }
        .sticky-calendar { position: sticky; top: 140px; z-index: 90; background: rgba(15,23,42,0.98); backdrop-filter: blur(20px); }
        
        /* Navigation */
        .nav-item { padding: 10px 20px; border-radius: 12px; font-size: 14px; font-weight: 500; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; white-space: nowrap; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); box-shadow: 0 4px 15px rgba(59,130,246,0.4); }
        
        /* Day selector buttons */
        .day-btn { padding: 8px 16px; border-radius: 10px; font-size: 13px; font-weight: 600; transition: all 0.3s ease; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
        .day-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-1px); }
        .day-btn.active { background: linear-gradient(135deg, #3b82f6, #2563eb); border-color: transparent; box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
        
        /* Date input */
        .date-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; padding: 10px 14px; color: white; font-size: 14px; transition: all 0.3s ease; }
        .date-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
        
        /* Calendar header cells */
        .cal-header { padding: 12px 8px; text-align: center; min-width: 80px; }
        .cal-header.today { background: rgba(251,191,36,0.15); border-radius: 12px; }
        .cal-header .day-name { font-size: 12px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; }
        .cal-header .day-num { font-size: 18px; font-weight: 700; margin-top: 2px; }
        .cal-header.today .day-num { color: #fbbf24; }
        
        /* Floor header */
        .floor-header { background: linear-gradient(90deg, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0) 100%); border-left: 4px solid #3b82f6; padding: 12px 20px; margin: 20px 0 12px 0; border-radius: 0 12px 12px 0; }
        .category-header { background: linear-gradient(90deg, rgba(139,92,246,0.2) 0%, rgba(139,92,246,0) 100%); border-left: 4px solid #8b5cf6; }
        
        /* Room row */
        .room-row { display: flex; align-items: stretch; margin-bottom: 8px; border-radius: 12px; overflow: hidden; transition: all 0.3s ease; }
        .room-row:hover { transform: translateX(4px); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        
        /* Room number cell */
        .room-num { min-width: 100px; padding: 16px; background: rgba(255,255,255,0.05); display: flex; flex-direction: column; justify-content: center; border-right: 1px solid rgba(255,255,255,0.05); }
        .room-num .num { font-size: 22px; font-weight: 700; }
        .room-num .type { font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 2px; }
        
        /* Status cells */
        .status-cell { flex: 1; min-width: 80px; padding: 12px 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s ease; cursor: pointer; border-right: 1px solid rgba(255,255,255,0.03); position: relative; overflow: hidden; }
        .status-cell::before { content: ''; position: absolute; inset: 0; opacity: 0; transition: opacity 0.3s ease; }
        .status-cell:hover::before { opacity: 1; background: rgba(255,255,255,0.05); }
        .status-cell:hover { transform: scale(1.02); }
        
        /* Status colors with gradients */
        .status-available { background: linear-gradient(135deg, rgba(16,185,129,0.2) 0%, rgba(5,150,105,0.1) 100%); }
        .status-available:hover { background: linear-gradient(135deg, rgba(16,185,129,0.4) 0%, rgba(5,150,105,0.2) 100%); }
        .status-booked { background: linear-gradient(135deg, rgba(239,68,68,0.25) 0%, rgba(220,38,38,0.15) 100%); }
        .status-checkin { background: linear-gradient(135deg, rgba(59,130,246,0.3) 0%, rgba(37,99,235,0.2) 100%); }
        .status-checkout { background: linear-gradient(135deg, rgba(139,92,246,0.3) 0%, rgba(124,58,237,0.2) 100%); }
        .status-turnover { background: linear-gradient(135deg, rgba(236,72,153,0.3) 0%, rgba(219,39,119,0.2) 100%); }
        
        .status-cell.today-col { box-shadow: inset 0 0 0 2px rgba(251,191,36,0.4); }
        .status-cell.selected { box-shadow: inset 0 0 0 3px #3b82f6; background: rgba(59,130,246,0.3) !important; }
        
        .status-icon { font-size: 16px; margin-bottom: 2px; }
        .status-text { font-size: 10px; color: rgba(255,255,255,0.7); text-align: center; line-height: 1.2; }
        .guest-name { font-size: 11px; font-weight: 600; color: white; max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Legend */
        .legend-item { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 12px; }
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
        
        /* Stats cards */
        .stat-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 16px 20px; text-align: center; transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-2px); background: rgba(255,255,255,0.05); }
        .stat-num { font-size: 28px; font-weight: 700; }
        .stat-label { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 4px; }
        
        /* Housekeeping cards */
        .hk-card { border-radius: 12px; padding: 14px 18px; display: flex; align-items: center; gap: 12px; transition: all 0.3s ease; }
        .hk-card:hover { transform: translateX(4px); }
        .hk-makeup { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .hk-dirty { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        .hk-turnover { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
        
        /* Movement cards */
        .movement-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 14px; margin-bottom: 10px; transition: all 0.3s ease; }
        .movement-card:hover { background: rgba(255,255,255,0.08); transform: translateX(4px); }
        
        /* Mobile dropdown */
        .mobile-select { width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; color: white; font-size: 14px; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 20px; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .animate-fade { animation: fadeIn 0.4s ease-out; }
        .animate-slide { animation: slideIn 0.3s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        
        /* Loader */
        .loader { width: 48px; height: 48px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Responsive */
        @media (max-width: 768px) {
            .room-num { min-width: 70px; padding: 10px; }
            .room-num .num { font-size: 18px; }
            .status-cell { min-width: 60px; padding: 8px 4px; }
            .cal-header { min-width: 60px; padding: 8px 4px; }
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState, useEffect, useMemo, useCallback} = React;

const PROXY = "https://beds24-proxy-1006186358018.us-central1.run.app";
const PROPERTY = 279646;

const getBDDate = (offset = 0) => {
    const now = new Date();
    const utc = now.getTime() + now.getTimezoneOffset() * 60000;
    const bd = new Date(utc + 6 * 3600000);
    bd.setDate(bd.getDate() + offset);
    return bd.toISOString().split('T')[0];
};
const getBDTime = () => {
    const now = new Date();
    const utc = now.getTime() + now.getTimezoneOffset() * 60000;
    return new Date(utc + 6 * 3600000).toLocaleTimeString("en-US", {hour: "2-digit", minute: "2-digit", hour12: true});
};
const formatDateFull = (d) => new Date(d+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});
const dayName = (d) => new Date(d+"T00:00:00").toLocaleDateString("en-US",{weekday:"short"});
const dayNum = (d) => new Date(d+"T00:00:00").getDate();
const shortMonth = (d) => new Date(d+"T00:00:00").toLocaleDateString("en-US",{month:"short"});

const ROOMS = [
    {id:583459, name:"Royal Sea View Couple", short:"Royal SV", max:2, units:[{id:1,n:"601"},{id:2,n:"602"},{id:3,n:"603"},{id:4,n:"604"}]},
    {id:583466, name:"Premium Sea View Couple", short:"Premium SV", max:2, units:[{id:1,n:"401"},{id:2,n:"404"},{id:3,n:"501"},{id:4,n:"504"}]},
    {id:583467, name:"Deluxe Bay View Couple", short:"Deluxe Bay", max:2, units:[{id:1,n:"402"},{id:2,n:"403"},{id:3,n:"502"},{id:4,n:"503"}]},
    {id:583468, name:"Deluxe Hill View Couple", short:"Deluxe Hill", max:2, units:[{id:1,n:"201"},{id:2,n:"204"},{id:3,n:"207"},{id:4,n:"301"},{id:5,n:"304"},{id:6,n:"307"},{id:7,n:"407"},{id:8,n:"507"}]},
    {id:583469, name:"Deluxe Urban View Couple", short:"Deluxe Urban", max:2, units:[{id:1,n:"101"},{id:2,n:"102"},{id:3,n:"103"},{id:4,n:"104"},{id:5,n:"107"},{id:6,n:"202"},{id:7,n:"203"},{id:8,n:"302"},{id:9,n:"303"}]},
    {id:583470, name:"Premium Sea View Family", short:"Premium Fam", max:4, units:[{id:1,n:"405"},{id:2,n:"406"},{id:3,n:"408"},{id:4,n:"505"},{id:5,n:"506"},{id:6,n:"508"},{id:7,n:"606"}]},
    {id:583471, name:"Deluxe Hill View Family", short:"Deluxe Hill Fam", max:4, units:[{id:1,n:"205"},{id:2,n:"206"},{id:3,n:"208"},{id:4,n:"305"},{id:5,n:"306"},{id:6,n:"308"}]},
    {id:583472, name:"Deluxe Urban View Family", short:"Deluxe Urban Fam", max:4, units:[{id:1,n:"105"},{id:2,n:"106"},{id:3,n:"108"}]}
];

const getFloor = (n) => Math.floor(parseInt(n) / 100);
const FLOORS = [1, 2, 3, 4, 5, 6];
const floorName = (f) => f === 1 ? "1st" : f === 2 ? "2nd" : f === 3 ? "3rd" : f + "th";

const getRoomInfo = (roomId, unitId) => {
    const r = ROOMS.find(x => x.id === roomId);
    const u = r?.units.find(x => x.id === unitId);
    return {room: r, unit: u, num: u?.n || "?"};
};

const STORAGE_KEY = "miami_checkin_status";
const loadCheckStatus = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); } catch { return {}; } };
const saveCheckStatus = (data) => { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); };

function App() {
    const [tab, setTab] = useState("floor");
    const [calDays, setCalDays] = useState(7);
    const [startDate, setStartDate] = useState(getBDDate());
    const [bookings, setBookings] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState("");
    const [selected, setSelected] = useState([]);
    const [showModal, setShowModal] = useState(false);
    const [time, setTime] = useState(getBDTime());
    const [checkStatus, setCheckStatus] = useState(loadCheckStatus());
    const [isMobile, setIsMobile] = useState(window.innerWidth < 768);

    useEffect(() => {
        const handleResize = () => setIsMobile(window.innerWidth < 768);
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
    }, []);

    useEffect(() => { const t = setInterval(() => setTime(getBDTime()), 60000); return () => clearInterval(t); }, []);

    const allRooms = useMemo(() => {
        let arr = [];
        ROOMS.forEach(r => r.units.forEach(u => arr.push({room: r, unit: u, floor: getFloor(u.n)})));
        return arr.sort((a,b) => parseInt(a.unit.n) - parseInt(b.unit.n));
    }, []);

    const roomsByFloor = useMemo(() => {
        const grouped = {};
        FLOORS.forEach(f => grouped[f] = []);
        allRooms.forEach(r => { if (grouped[r.floor]) grouped[r.floor].push(r); });
        return grouped;
    }, [allRooms]);

    const fetchData = useCallback(async () => {
        setLoading(true);
        setError("");
        try {
            const res = await fetch(`${PROXY}?endpoint=bookings&propertyId=${PROPERTY}&departureFrom=${getBDDate(-7)}`);
            const data = await res.json();
            if (data.success) setBookings(data.data.filter(b => b.status !== "cancelled"));
            else setError("API: " + (data.error || "Error"));
        } catch(e) { setError("Network: " + e.message); }
        setLoading(false);
    }, []);

    useEffect(() => { fetchData(); const i = setInterval(fetchData, 120000); return () => clearInterval(i); }, [fetchData]);

    const getBooking = useCallback((roomId, unitId, d) => {
        return bookings.find(b => b.roomId === roomId && b.unitId === unitId && d >= b.arrival && d < b.departure);
    }, [bookings]);

    const getCheckout = useCallback((roomId, unitId, d) => {
        return bookings.find(b => b.roomId === roomId && b.unitId === unitId && b.departure === d);
    }, [bookings]);

    const getCheckin = useCallback((roomId, unitId, d) => {
        return bookings.find(b => b.roomId === roomId && b.unitId === unitId && b.arrival === d);
    }, [bookings]);

    const getDays = useCallback((count) => {
        const days = [];
        const start = new Date(startDate + "T00:00:00");
        for (let i = 0; i < count; i++) {
            const d = new Date(start);
            d.setDate(d.getDate() + i);
            days.push(d.toISOString().split('T')[0]);
        }
        return days;
    }, [startDate]);

    const days = useMemo(() => getDays(calDays), [getDays, calDays]);
    const today = getBDDate();

    const toggleSelect = (room, unit, date) => {
        const key = `${room.id}-${unit.id}-${date}`;
        setSelected(s => {
            const exists = s.find(x => x.key === key);
            if (exists) return s.filter(x => x.key !== key);
            return [...s, {key, room, unit, date}];
        });
    };

    const toggleCheckIn = (id) => {
        const ns = {...checkStatus};
        ns[id] = ns[id] === "checkedin" ? null : "checkedin";
        if (!ns[id]) delete ns[id];
        setCheckStatus(ns);
        saveCheckStatus(ns);
    };

    const toggleCheckOut = (id) => {
        const ns = {...checkStatus};
        ns[id] = ns[id] === "checkedout" ? null : "checkedout";
        if (!ns[id]) delete ns[id];
        setCheckStatus(ns);
        saveCheckStatus(ns);
    };

    const stats = useMemo(() => {
        let occ=0, avail=0, cin=0, cout=0;
        allRooms.forEach(({room, unit}) => { if(getBooking(room.id, unit.id, today)) occ++; else avail++; });
        bookings.forEach(b => { if(b.arrival === today) cin++; if(b.departure === today) cout++; });
        return {total: allRooms.length, occ, avail, cin, cout};
    }, [allRooms, bookings, getBooking, today]);

    const housekeeping = useMemo(() => {
        const makeup = [], dirty = [], turnover = [];
        allRooms.forEach(({room, unit}) => {
            const co = bookings.find(b => b.roomId === room.id && b.unitId === unit.id && b.departure === today);
            const ci = bookings.find(b => b.roomId === room.id && b.unitId === unit.id && b.arrival === today);
            const stay = bookings.find(b => b.roomId === room.id && b.unitId === unit.id && b.arrival < today && b.departure > today);
            if (co && ci) turnover.push({room, unit, out: co, in: ci});
            else if (co && !ci) dirty.push({room, unit, booking: co});
            else if (stay) makeup.push({room, unit, booking: stay});
        });
        return {makeup, dirty, turnover};
    }, [allRooms, bookings, today]);

    const movements = useMemo(() => {
        const todayIn = bookings.filter(b => b.arrival === today);
        const todayOut = bookings.filter(b => b.departure === today);
        const guests = bookings.filter(b => b.arrival <= today && b.departure > today);
        return {
            pendingIn: todayIn.filter(b => checkStatus[b.id] !== "checkedin"),
            doneIn: todayIn.filter(b => checkStatus[b.id] === "checkedin"),
            pendingOut: todayOut.filter(b => checkStatus[b.id] !== "checkedout"),
            doneOut: todayOut.filter(b => checkStatus[b.id] === "checkedout"),
            guests
        };
    }, [bookings, checkStatus, today]);

    const tabs = [
        {id: "floor", label: "üè¢ By Floor", icon: "üè¢"},
        {id: "category", label: "üìÅ By Category", icon: "üìÅ"},
        {id: "housekeeping", label: "üßπ Housekeeping", icon: "üßπ"},
        {id: "movements", label: "‚ÜîÔ∏è Movements", icon: "‚ÜîÔ∏è"},
        {id: "dashboard", label: "üìä Dashboard", icon: "üìä"}
    ];

    const StatusCell = ({room, unit, date}) => {
        const booking = getBooking(room.id, unit.id, date);
        const checkout = getCheckout(room.id, unit.id, date);
        const checkin = getCheckin(room.id, unit.id, date);
        const isToday = date === today;
        const isSelected = selected.find(x => x.key === `${room.id}-${unit.id}-${date}`);
        const isTurnover = checkout && checkin;

        let cls = "status-available";
        let icon = "‚úì";
        let text = "";
        let guestName = "";

        if (isTurnover) {
            cls = "status-turnover";
            icon = "üîÑ";
            text = "Turnover";
            guestName = checkin.firstName?.substring(0,8);
        } else if (booking) {
            if (booking.arrival === date) {
                cls = "status-checkin";
                icon = "‚¨áÔ∏è";
                text = "Check-in";
            } else {
                cls = "status-booked";
                icon = "";
            }
            guestName = booking.firstName?.substring(0,8);
        } else if (checkout) {
            cls = "status-checkout";
            icon = "‚¨ÜÔ∏è";
            text = "C/O";
        }

        const canSelect = !booking && !checkout;

        return (
            <div className={`status-cell ${cls} ${isToday ? 'today-col' : ''} ${isSelected ? 'selected' : ''}`}
                 onClick={() => canSelect && toggleSelect(room, unit, date)}>
                {icon && <span className="status-icon">{icon}</span>}
                {guestName && <span className="guest-name">{guestName}</span>}
                {text && !guestName && <span className="status-text">{text}</span>}
            </div>
        );
    };

    const RoomRow = ({room, unit}) => (
        <div className="room-row glass animate-slide">
            <div className="room-num">
                <span className="num">{unit.n}</span>
                <span className="type">{room.short}</span>
            </div>
            {days.map(d => <StatusCell key={d} room={room} unit={unit} date={d}/>)}
        </div>
    );

    const CalendarHeader = () => (
        <div className="sticky-calendar py-3 px-4 border-b border-white border-opacity-5">
            <div className="flex items-center">
                <div className="room-num opacity-0 pointer-events-none">
                    <span className="num">000</span>
                    <span className="type">Type</span>
                </div>
                {days.map(d => (
                    <div key={d} className={`cal-header flex-1 ${d === today ? 'today' : ''}`}>
                        <div className="day-name">{dayName(d)}</div>
                        <div className="day-num">{dayNum(d)}</div>
                        <div className="day-name">{shortMonth(d)}</div>
                    </div>
                ))}
            </div>
        </div>
    );

    const MovementCard = ({booking, type, onToggle}) => {
        const {num, room} = getRoomInfo(booking.roomId, booking.unitId);
        return (
            <div className="movement-card flex justify-between items-center">
                <div className="flex-1 min-w-0">
                    <div className="font-semibold truncate">{booking.firstName} {booking.lastName}</div>
                    <div className="text-sm text-gray-400">Room {num} ‚Ä¢ {room?.short}</div>
                    {booking.mobile && <div className="text-xs text-gray-500 mt-1">üìû {booking.mobile}</div>}
                </div>
                <button onClick={() => onToggle(booking.id)} 
                    className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl transition-all ${type === "done" ? 'bg-green-500 text-white' : 'bg-white bg-opacity-10 hover:bg-opacity-20'}`}>
                    {type === "done" ? "‚Ü©" : "‚úì"}
                </button>
            </div>
        );
    };

    return (
        <div className="min-h-screen pb-24">
            {/* Header */}
            <div className="sticky-header border-b border-white border-opacity-5">
                <div className="max-w-full px-4 py-4">
                    <div className="flex flex-wrap justify-between items-center gap-4 mb-4">
                        <div>
                            <h1 className="text-2xl font-bold flex items-center gap-2">üè® Miami Beach Resort</h1>
                            <p className="text-gray-400 text-sm mt-1">Cox's Bazar ‚Ä¢ {formatDateFull(today)} ‚Ä¢ {time}</p>
                        </div>
                        <button onClick={fetchData} disabled={loading} 
                            className="px-5 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 rounded-xl font-medium flex items-center gap-2 transition-all shadow-lg shadow-blue-500/20">
                            {loading ? <span className="animate-spin">‚è≥</span> : "üîÑ"} Refresh
                        </button>
                    </div>

                    {/* Navigation */}
                    {isMobile ? (
                        <select value={tab} onChange={e => setTab(e.target.value)} className="mobile-select mb-4">
                            {tabs.map(t => <option key={t.id} value={t.id}>{t.icon} {t.label.replace(t.icon, '').trim()}</option>)}
                        </select>
                    ) : (
                        <div className="flex gap-2 mb-4 overflow-x-auto pb-1">
                            {tabs.map(t => (
                                <div key={t.id} onClick={() => setTab(t.id)} className={`nav-item ${tab === t.id ? 'active' : ''}`}>
                                    {t.label}
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Stats Bar */}
                    <div className="grid grid-cols-5 gap-3 mb-4">
                        <div className="stat-card"><div className="stat-num text-white">{stats.total}</div><div className="stat-label">Total</div></div>
                        <div className="stat-card"><div className="stat-num text-green-400">{stats.avail}</div><div className="stat-label">Available</div></div>
                        <div className="stat-card"><div className="stat-num text-red-400">{stats.occ}</div><div className="stat-label">Occupied</div></div>
                        <div className="stat-card"><div className="stat-num text-blue-400">{stats.cin}</div><div className="stat-label">Check-ins</div></div>
                        <div className="stat-card"><div className="stat-num text-purple-400">{stats.cout}</div><div className="stat-label">Check-outs</div></div>
                    </div>

                    {/* Calendar Controls - only for floor/category tabs */}
                    {(tab === "floor" || tab === "category") && (
                        <div className="flex flex-wrap items-center gap-3">
                            <div className="flex items-center gap-2">
                                <span className="text-gray-400">üìÖ</span>
                                <input type="date" value={startDate} onChange={e => setStartDate(e.target.value)} className="date-input"/>
                            </div>
                            <button onClick={() => setStartDate(getBDDate())} className={`day-btn ${startDate === getBDDate() ? 'active' : ''}`}>Today</button>
                            <div className="h-6 w-px bg-white bg-opacity-20"></div>
                            <span className="text-gray-400 text-sm">Days:</span>
                            {[1, 3, 7, 15].map(d => (
                                <button key={d} onClick={() => setCalDays(d)} className={`day-btn ${calDays === d ? 'active' : ''}`}>{d}</button>
                            ))}
                            <div className="flex-1"></div>
                            <div className="flex gap-2 flex-wrap">
                                <span className="legend-item"><span className="legend-dot bg-green-500"></span>Available</span>
                                <span className="legend-item"><span className="legend-dot bg-red-500"></span>Occupied</span>
                                <span className="legend-item"><span className="legend-dot bg-blue-500"></span>Check-in</span>
                                <span className="legend-item"><span className="legend-dot bg-purple-500"></span>Check-out</span>
                            </div>
                        </div>
                    )}
                </div>
            </div>

            {error && <div className="mx-4 mt-4 p-4 bg-red-500 bg-opacity-20 rounded-xl text-red-300">{error}</div>}
            {loading && <div className="flex justify-center py-16"><div className="loader"></div></div>}

            {!loading && (
                <div className="max-w-full">
                    {/* BY FLOOR */}
                    {tab === "floor" && (
                        <>
                            <CalendarHeader/>
                            <div className="px-4">
                                {FLOORS.map(floor => {
                                    const rooms = roomsByFloor[floor];
                                    if (!rooms?.length) return null;
                                    return (
                                        <div key={floor} className="animate-fade">
                                            <div className="floor-header">
                                                <span className="text-lg font-bold">üè¢ {floorName(floor)} Floor</span>
                                                <span className="text-gray-400 text-sm ml-3">{rooms.length} rooms</span>
                                            </div>
                                            {rooms.map(({room, unit}) => <RoomRow key={`${room.id}-${unit.id}`} room={room} unit={unit}/>)}
                                        </div>
                                    );
                                })}
                            </div>
                        </>
                    )}

                    {/* BY CATEGORY */}
                    {tab === "category" && (
                        <>
                            <CalendarHeader/>
                            <div className="px-4">
                                {ROOMS.map(roomType => (
                                    <div key={roomType.id} className="animate-fade">
                                        <div className="floor-header category-header">
                                            <span className="text-lg font-bold">üìÅ {roomType.name}</span>
                                            <span className="text-gray-400 text-sm ml-3">{roomType.units.length} rooms ‚Ä¢ üë§{roomType.max}A</span>
                                        </div>
                                        {roomType.units.map(unit => <RoomRow key={`${roomType.id}-${unit.id}`} room={roomType} unit={unit}/>)}
                                    </div>
                                ))}
                            </div>
                        </>
                    )}

                    {/* HOUSEKEEPING */}
                    {tab === "housekeeping" && (
                        <div className="px-4 py-6">
                            <h2 className="text-xl font-bold mb-6">üßπ Housekeeping - {formatDateFull(today)}</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="text-lg font-bold text-cyan-400 mb-4 flex items-center gap-2">
                                        üõèÔ∏è Make-up <span className="text-sm font-normal text-gray-400">({housekeeping.makeup.length})</span>
                                    </h3>
                                    <div className="space-y-3">
                                        {housekeeping.makeup.map(({room, unit, booking}) => (
                                            <div key={`${room.id}-${unit.id}`} className="hk-card hk-makeup">
                                                <div className="text-2xl font-bold">{unit.n}</div>
                                                <div className="flex-1"><div className="font-medium">{booking.firstName}</div><div className="text-sm opacity-80">{room.short}</div></div>
                                            </div>
                                        ))}
                                        {!housekeeping.makeup.length && <div className="text-gray-500 text-center py-8">No rooms</div>}
                                    </div>
                                </div>
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="text-lg font-bold text-orange-400 mb-4 flex items-center gap-2">
                                        üßΩ Dirty <span className="text-sm font-normal text-gray-400">({housekeeping.dirty.length})</span>
                                    </h3>
                                    <div className="space-y-3">
                                        {housekeeping.dirty.map(({room, unit, booking}) => (
                                            <div key={`${room.id}-${unit.id}`} className="hk-card hk-dirty">
                                                <div className="text-2xl font-bold">{unit.n}</div>
                                                <div className="flex-1"><div className="font-medium">{booking.firstName}</div><div className="text-sm opacity-80">{room.short}</div></div>
                                            </div>
                                        ))}
                                        {!housekeeping.dirty.length && <div className="text-gray-500 text-center py-8">No rooms</div>}
                                    </div>
                                </div>
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="text-lg font-bold text-pink-400 mb-4 flex items-center gap-2">
                                        üîÑ Turnover <span className="text-sm font-normal text-gray-400">({housekeeping.turnover.length})</span>
                                    </h3>
                                    <div className="space-y-3">
                                        {housekeeping.turnover.map(({room, unit, out, in: ci}) => (
                                            <div key={`${room.id}-${unit.id}`} className="hk-card hk-turnover">
                                                <div className="text-2xl font-bold">{unit.n}</div>
                                                <div className="flex-1"><div className="font-medium">{out.firstName} ‚Üí {ci.firstName}</div><div className="text-sm opacity-80">{room.short}</div></div>
                                            </div>
                                        ))}
                                        {!housekeeping.turnover.length && <div className="text-gray-500 text-center py-8">No rooms</div>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MOVEMENTS */}
                    {tab === "movements" && (
                        <div className="px-4 py-6">
                            <h2 className="text-xl font-bold mb-6">‚ÜîÔ∏è Movements - {formatDateFull(today)}</h2>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="font-bold text-blue-400 mb-4">‚¨áÔ∏è Today's Check-in ({movements.pendingIn.length})</h3>
                                    <div className="max-h-80 overflow-y-auto">{movements.pendingIn.map(b => <MovementCard key={b.id} booking={b} type="pending" onToggle={toggleCheckIn}/>)}</div>
                                    {!movements.pendingIn.length && <div className="text-gray-500 text-center py-6">None</div>}
                                </div>
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="font-bold text-green-400 mb-4">‚úÖ Checked-in ({movements.doneIn.length})</h3>
                                    <div className="max-h-80 overflow-y-auto">{movements.doneIn.map(b => <MovementCard key={b.id} booking={b} type="done" onToggle={toggleCheckIn}/>)}</div>
                                    {!movements.doneIn.length && <div className="text-gray-500 text-center py-6">None</div>}
                                </div>
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="font-bold text-purple-400 mb-4">‚¨ÜÔ∏è Today's Check-out ({movements.pendingOut.length})</h3>
                                    <div className="max-h-80 overflow-y-auto">{movements.pendingOut.map(b => <MovementCard key={b.id} booking={b} type="pending" onToggle={toggleCheckOut}/>)}</div>
                                    {!movements.pendingOut.length && <div className="text-gray-500 text-center py-6">None</div>}
                                </div>
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="font-bold text-orange-400 mb-4">üëã Checked-out ({movements.doneOut.length})</h3>
                                    <div className="max-h-80 overflow-y-auto">{movements.doneOut.map(b => <MovementCard key={b.id} booking={b} type="done" onToggle={toggleCheckOut}/>)}</div>
                                    {!movements.doneOut.length && <div className="text-gray-500 text-center py-6">None</div>}
                                </div>
                            </div>
                            <div className="glass rounded-2xl p-5">
                                <h3 className="font-bold text-lg mb-4">üè† Current Guests ({movements.guests.length})</h3>
                                <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3">
                                    {movements.guests.map(b => {
                                        const {num, room} = getRoomInfo(b.roomId, b.unitId);
                                        return (
                                            <div key={b.id} className="glass rounded-xl p-4">
                                                <div className="flex justify-between items-start">
                                                    <div className="font-bold truncate flex-1">{b.firstName}</div>
                                                    <div className="text-2xl font-bold text-blue-400 ml-2">{num}</div>
                                                </div>
                                                <div className="text-xs text-gray-400 mt-1">{room?.short}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* DASHBOARD */}
                    {tab === "dashboard" && (
                        <div className="px-4 py-6">
                            <h2 className="text-xl font-bold mb-6">üìä Dashboard</h2>
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="font-bold mb-4">Occupancy by Room Type</h3>
                                    {ROOMS.map(r => {
                                        const booked = r.units.filter(u => getBooking(r.id, u.id, today)).length;
                                        const pct = Math.round(booked / r.units.length * 100);
                                        return (
                                            <div key={r.id} className="mb-4">
                                                <div className="flex justify-between text-sm mb-1">
                                                    <span>{r.name}</span>
                                                    <span className="text-gray-400">{booked}/{r.units.length} ({pct}%)</span>
                                                </div>
                                                <div className="h-3 bg-white bg-opacity-10 rounded-full overflow-hidden">
                                                    <div className="h-full bg-gradient-to-r from-blue-500 to-blue-400 rounded-full transition-all duration-500" style={{width: pct+"%"}}></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="glass rounded-2xl p-5">
                                    <h3 className="font-bold mb-4">Occupancy by Floor</h3>
                                    <div className="grid grid-cols-3 gap-4">
                                        {FLOORS.map(f => {
                                            const rooms = roomsByFloor[f] || [];
                                            const booked = rooms.filter(({room, unit}) => getBooking(room.id, unit.id, today)).length;
                                            const pct = rooms.length ? Math.round(booked / rooms.length * 100) : 0;
                                            return (
                                                <div key={f} className="text-center p-4 glass rounded-xl">
                                                    <div className="text-gray-400 text-sm">Floor {f}</div>
                                                    <div className="text-3xl font-bold mt-1">{pct}%</div>
                                                    <div className="text-xs text-gray-400">{booked}/{rooms.length}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            )}

            {/* Floating Book Button */}
            {selected.length > 0 && (
                <div className="fixed bottom-6 left-4 right-4 z-50 max-w-lg mx-auto">
                    <button onClick={() => setShowModal(true)} 
                        className="w-full px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl text-white font-bold shadow-2xl shadow-blue-500/30 flex items-center justify-center gap-3 hover:shadow-blue-500/50 transition-all">
                        ‚ûï Book {selected.length} Room{selected.length > 1 ? 's' : ''}
                        <span className="absolute right-4" onClick={e => {e.stopPropagation(); setSelected([]);}}>‚úï</span>
                    </button>
                </div>
            )}

            {showModal && <BookingModal selected={selected} onClose={() => {setShowModal(false); setSelected([]); fetchData();}}/>}
        </div>
    );
}

function BookingModal({selected, onClose}) {
    const [form, setForm] = useState({
        guests: [{name: ""}], phones: [""], email: "", nid: "", dob: "",
        checkIn: selected[0]?.date || getBDDate(),
        checkOut: getBDDate(1)
    });
    const [status, setStatus] = useState("");

    const addGuest = () => form.guests.length < 3 && setForm({...form, guests: [...form.guests, {name: ""}]});
    const addPhone = () => form.phones.length < 3 && setForm({...form, phones: [...form.phones, ""]});
    const updateGuest = (i, v) => { const g = [...form.guests]; g[i].name = v; setForm({...form, guests: g}); };
    const updatePhone = (i, v) => { const p = [...form.phones]; p[i] = v; setForm({...form, phones: p}); };
    const removeGuest = (i) => form.guests.length > 1 && setForm({...form, guests: form.guests.filter((_,idx) => idx !== i)});
    const removePhone = (i) => form.phones.length > 1 && setForm({...form, phones: form.phones.filter((_,idx) => idx !== i)});

    const submit = async (e) => {
        e.preventDefault();
        setStatus("loading");
        try {
            const names = form.guests.map(g => g.name).filter(Boolean).join(", ");
            const phones = form.phones.filter(Boolean).join(", ");
            const data = selected.map(s => ({
                propertyId: PROPERTY, roomId: s.room.id, unitId: s.unit.id,
                arrival: form.checkIn, departure: form.checkOut,
                numAdult: s.room.max, numChild: 0, status: "confirmed",
                firstName: names, email: form.email || "default",
                mobile: phones, custom4: form.nid || "default", custom5: form.dob || "default",
                referer: "miami_frontdesk"
            }));
            const res = await fetch(PROXY + "?endpoint=bookings&action=write", {
                method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify(data)
            });
            const result = await res.json();
            if (result.success) { setStatus("success"); setTimeout(onClose, 1500); }
            else setStatus("error: " + (result.error || "Failed"));
        } catch(e) { setStatus("error: " + e.message); }
    };

    if (status === "success") return (
        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
            <div className="glass rounded-3xl p-10 text-center animate-fade">
                <div className="text-6xl mb-4">‚úÖ</div>
                <div className="text-2xl font-bold">Booking Created!</div>
            </div>
        </div>
    );

    return (
        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 overflow-y-auto">
            <div className="glass rounded-3xl p-6 w-full max-w-md animate-fade">
                <div className="flex justify-between items-center mb-5">
                    <h3 className="text-xl font-bold">‚ûï New Booking</h3>
                    <button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">√ó</button>
                </div>
                <div className="flex flex-wrap gap-2 mb-5">
                    {selected.map(s => <span key={s.key} className="px-3 py-1.5 bg-blue-500/30 rounded-lg text-sm font-medium">{s.unit.n}</span>)}
                </div>
                <form onSubmit={submit} className="space-y-4">
                    <div className="grid grid-cols-2 gap-3">
                        <div><label className="text-gray-400 text-xs mb-1 block">Check-in</label>
                            <input type="date" required value={form.checkIn} onChange={e => setForm({...form, checkIn: e.target.value})} className="date-input w-full"/></div>
                        <div><label className="text-gray-400 text-xs mb-1 block">Check-out</label>
                            <input type="date" required min={form.checkIn} value={form.checkOut} onChange={e => setForm({...form, checkOut: e.target.value})} className="date-input w-full"/></div>
                    </div>
                    <div>
                        <div className="flex justify-between mb-2"><label className="text-gray-400 text-xs">Guests</label>
                            {form.guests.length < 3 && <button type="button" onClick={addGuest} className="text-blue-400 text-xs">+ Add</button>}</div>
                        {form.guests.map((g, i) => (
                            <div key={i} className="flex gap-2 mb-2">
                                <input type="text" required value={g.name} onChange={e => updateGuest(i, e.target.value)} placeholder={`Guest ${i+1}`} className="date-input flex-1"/>
                                {form.guests.length > 1 && <button type="button" onClick={() => removeGuest(i)} className="text-red-400 px-2">‚úï</button>}
                            </div>
                        ))}
                    </div>
                    <div>
                        <div className="flex justify-between mb-2"><label className="text-gray-400 text-xs">Phones</label>
                            {form.phones.length < 3 && <button type="button" onClick={addPhone} className="text-blue-400 text-xs">+ Add</button>}</div>
                        {form.phones.map((p, i) => (
                            <div key={i} className="flex gap-2 mb-2">
                                <input type="tel" required value={p} onChange={e => updatePhone(i, e.target.value)} placeholder={`Phone ${i+1}`} className="date-input flex-1"/>
                                {form.phones.length > 1 && <button type="button" onClick={() => removePhone(i)} className="text-red-400 px-2">‚úï</button>}
                            </div>
                        ))}
                    </div>
                    <input type="email" value={form.email} onChange={e => setForm({...form, email: e.target.value})} placeholder="Email (optional)" className="date-input w-full"/>
                    <div className="grid grid-cols-2 gap-3">
                        <input type="text" value={form.nid} onChange={e => setForm({...form, nid: e.target.value})} placeholder="NID" className="date-input"/>
                        <input type="text" value={form.dob} onChange={e => setForm({...form, dob: e.target.value})} placeholder="DOB" className="date-input"/>
                    </div>
                    {status.startsWith("error") && <div className="p-3 bg-red-500/20 rounded-xl text-red-300 text-sm">{status}</div>}
                    <div className="flex gap-3 pt-2">
                        <button type="button" onClick={onClose} className="flex-1 py-3 glass rounded-xl font-medium">Cancel</button>
                        <button type="submit" disabled={status === "loading"} className="flex-1 py-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl font-bold disabled:opacity-50">
                            {status === "loading" ? "..." : "Book"}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
}

ReactDOM.render(<App/>, document.getElementById("root"));
</script>
</body>
</html>
