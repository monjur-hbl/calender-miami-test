<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miami Beach Resort - Front Desk</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #1a1d23; min-height: 100vh; color: #fff; }
        
        .header { background: #12151a; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }
        
        .nav-btn { padding: 10px 18px; border-radius: 8px; font-size: 13px; font-weight: 500; border: none; cursor: pointer; transition: all 0.2s; background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.6); }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .nav-btn.active { background: #10b981; color: white; }
        
        .day-btn { padding: 6px 14px; border-radius: 6px; font-size: 12px; font-weight: 500; border: none; cursor: pointer; transition: all 0.2s; background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.6); }
        .day-btn:hover { background: rgba(255,255,255,0.1); }
        .day-btn.active { background: #10b981; color: white; }
        
        .date-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; padding: 8px 12px; color: #fff; font-size: 13px; }
        .date-input:focus { outline: none; border-color: #10b981; }
        
        .stat-box { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 12px; text-align: center; }
        .stat-num { font-size: 24px; font-weight: 700; }
        .stat-label { font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 2px; text-transform: uppercase; }
        
        /* Calendar Grid */
        .cal-container { padding: 0 12px 100px 12px; }
        
        /* Header Row */
        .cal-header-row { display: flex; gap: 6px; padding: 12px 0; position: sticky; top: 155px; z-index: 50; background: #1a1d23; }
        .cal-header-cell { flex: 1; min-width: 90px; text-align: center; padding: 10px 4px; }
        .cal-header-cell.room-col { min-width: 110px; max-width: 110px; }
        .cal-header-cell .day-name { font-size: 11px; color: rgba(255,255,255,0.5); text-transform: uppercase; }
        .cal-header-cell .day-num { font-size: 16px; font-weight: 600; }
        .cal-header-cell.today { background: rgba(251,191,36,0.15); border-radius: 8px; }
        .cal-header-cell.today .day-num { color: #fbbf24; }
        
        /* Floor Section */
        .floor-section { margin-bottom: 16px; }
        .floor-header { background: rgba(0,0,0,0.3); padding: 8px 14px; border-radius: 8px; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        .floor-title { font-weight: 600; font-size: 13px; }
        .floor-count { color: rgba(255,255,255,0.5); font-size: 12px; }
        
        /* Room Row */
        .room-row { display: flex; gap: 6px; margin-bottom: 6px; }
        
        /* Room Label Box */
        .room-label-box { min-width: 110px; max-width: 110px; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; justify-content: center; }
        .room-num { font-size: 20px; font-weight: 700; }
        .room-type { font-size: 9px; color: rgba(255,255,255,0.6); line-height: 1.3; margin-top: 2px; }
        .room-cap { font-size: 9px; color: rgba(255,255,255,0.4); margin-top: 2px; }
        
        /* Status Cell Box */
        .status-box { flex: 1; min-width: 90px; border-radius: 10px; padding: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.15s; position: relative; min-height: 70px; }
        .status-box:hover { transform: scale(1.02); filter: brightness(1.1); z-index: 10; }
        .status-box.today-col { box-shadow: inset 0 0 0 2px rgba(251,191,36,0.5); }
        .status-box.selected { box-shadow: 0 0 0 3px #fff !important; }
        
        /* Status Colors */
        .st-available { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .st-occupied { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .st-checkin { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .st-checkout { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .st-turnover { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        
        .status-icon { font-size: 14px; margin-bottom: 2px; }
        .status-text { font-size: 9px; color: rgba(255,255,255,0.9); font-weight: 600; text-transform: uppercase; }
        .guest-name { font-size: 11px; font-weight: 600; color: white; max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-align: center; }
        .guest-date { font-size: 9px; color: rgba(255,255,255,0.7); }
        
        /* Info icon on occupied cells */
        .info-icon { position: absolute; top: 4px; right: 4px; width: 16px; height: 16px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }
        
        /* Guest Info Popup */
        .guest-popup { position: fixed; z-index: 200; background: #1e2128; border: 1px solid rgba(255,255,255,0.15); border-radius: 14px; padding: 18px; min-width: 280px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .popup-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 14px; }
        .popup-title { font-size: 18px; font-weight: 700; }
        .popup-room { font-size: 12px; color: rgba(255,255,255,0.5); }
        .popup-close { background: none; border: none; color: rgba(255,255,255,0.5); font-size: 20px; cursor: pointer; }
        .popup-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .popup-row:last-child { border-bottom: none; }
        .popup-label { color: rgba(255,255,255,0.5); font-size: 12px; }
        .popup-value { font-weight: 600; font-size: 13px; }
        .popup-value.due { color: #ef4444; }
        .popup-value.paid { color: #10b981; }
        
        /* Mobile Select */
        .mobile-select { width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; font-size: 13px; }
        
        /* Search Tab */
        .search-section { padding: 16px; }
        .search-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 16px; }
        .search-card { background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; padding: 14px; cursor: pointer; transition: all 0.2s; }
        .search-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16,185,129,0.3); }
        .search-card.selected { box-shadow: 0 0 0 3px #fff; }
        .search-room { font-size: 24px; font-weight: 700; }
        .search-type { font-size: 11px; opacity: 0.8; margin-top: 2px; }
        
        /* Housekeeping */
        .hk-section { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 18px; }
        .hk-card { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 10px; margin-bottom: 8px; }
        .hk-makeup { background: linear-gradient(135deg, #0ea5e9, #0284c7); }
        .hk-dirty { background: linear-gradient(135deg, #f97316, #ea580c); }
        .hk-turnover { background: linear-gradient(135deg, #a855f7, #9333ea); }
        .hk-room { font-size: 22px; font-weight: 700; min-width: 50px; }
        
        /* Movement */
        .mv-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .mv-btn { width: 42px; height: 42px; border-radius: 8px; border: none; cursor: pointer; font-size: 16px; transition: all 0.2s; }
        .mv-btn-pending { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6); }
        .mv-btn-pending:hover { background: #10b981; color: white; }
        .mv-btn-done { background: #10b981; color: white; }
        
        /* Legend */
        .legend { display: flex; gap: 12px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: rgba(255,255,255,0.6); }
        .legend-dot { width: 12px; height: 12px; border-radius: 4px; }
        
        .loader { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }
        
        @media (max-width: 768px) {
            .room-label-box { min-width: 80px; max-width: 80px; padding: 8px; }
            .room-num { font-size: 16px; }
            .status-box { min-width: 65px; min-height: 60px; padding: 6px; }
            .cal-header-cell { min-width: 65px; }
            .cal-header-cell.room-col { min-width: 80px; max-width: 80px; }
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState, useEffect, useMemo, useCallback} = React;

const PROXY = "https://beds24-proxy-1006186358018.us-central1.run.app";
const PROPERTY = 279646;

const getBDDate = (offset = 0) => {
    const now = new Date();
    const utc = now.getTime() + now.getTimezoneOffset() * 60000;
    const bd = new Date(utc + 6 * 3600000);
    bd.setDate(bd.getDate() + offset);
    return bd.toISOString().split('T')[0];
};
const getBDTime = () => {
    const now = new Date();
    const utc = now.getTime() + now.getTimezoneOffset() * 60000;
    return new Date(utc + 6 * 3600000).toLocaleTimeString("en-US", {hour: "2-digit", minute: "2-digit", hour12: true});
};
const formatDate = (d) => new Date(d+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});
const dayName = (d) => new Date(d+"T00:00:00").toLocaleDateString("en-US",{weekday:"short"});
const dayNum = (d) => new Date(d+"T00:00:00").getDate();

const ROOMS = [
    {id:583459, name:"Royal Sea View Couple", short:"Royal SV", max:2, units:[{id:1,n:"601"},{id:2,n:"602"},{id:3,n:"603"},{id:4,n:"604"}]},
    {id:583466, name:"Premium Sea View Couple", short:"Premium SV", max:2, units:[{id:1,n:"401"},{id:2,n:"404"},{id:3,n:"501"},{id:4,n:"504"}]},
    {id:583467, name:"Deluxe Bay View Couple", short:"Deluxe Bay", max:2, units:[{id:1,n:"402"},{id:2,n:"403"},{id:3,n:"502"},{id:4,n:"503"}]},
    {id:583468, name:"Deluxe Hill View Couple", short:"Deluxe Hill", max:2, units:[{id:1,n:"201"},{id:2,n:"204"},{id:3,n:"207"},{id:4,n:"301"},{id:5,n:"304"},{id:6,n:"307"},{id:7,n:"407"},{id:8,n:"507"}]},
    {id:583469, name:"Deluxe Urban View Couple", short:"Deluxe Urban", max:2, units:[{id:1,n:"101"},{id:2,n:"102"},{id:3,n:"103"},{id:4,n:"104"},{id:5,n:"107"},{id:6,n:"202"},{id:7,n:"203"},{id:8,n:"302"},{id:9,n:"303"}]},
    {id:583470, name:"Premium Sea View Family", short:"Premium Fam", max:4, units:[{id:1,n:"405"},{id:2,n:"406"},{id:3,n:"408"},{id:4,n:"505"},{id:5,n:"506"},{id:6,n:"508"},{id:7,n:"606"}]},
    {id:583471, name:"Deluxe Hill View Family", short:"Deluxe Hill Fam", max:4, units:[{id:1,n:"205"},{id:2,n:"206"},{id:3,n:"208"},{id:4,n:"305"},{id:5,n:"306"},{id:6,n:"308"}]},
    {id:583472, name:"Deluxe Urban View Family", short:"Deluxe Urban Fam", max:4, units:[{id:1,n:"105"},{id:2,n:"106"},{id:3,n:"108"}]}
];

const getFloor = (n) => Math.floor(parseInt(n) / 100);
const FLOORS = [1, 2, 3, 4, 5, 6];
const floorName = (f) => f === 1 ? "1st" : f === 2 ? "2nd" : f === 3 ? "3rd" : f + "th";
const getRoomInfo = (roomId, unitId) => {
    const r = ROOMS.find(x => x.id === roomId);
    const u = r?.units.find(x => x.id === unitId);
    return {room: r, unit: u, num: u?.n || "?"};
};

const STORAGE_KEY = "miami_checkin_v3";
const loadStatus = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); } catch { return {}; } };
const saveStatus = (d) => localStorage.setItem(STORAGE_KEY, JSON.stringify(d));

function App() {
    const [tab, setTab] = useState("floor");
    const [calDays, setCalDays] = useState(7);
    const [startDate, setStartDate] = useState(getBDDate());
    const [bookings, setBookings] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState("");
    const [selected, setSelected] = useState([]);
    const [showModal, setShowModal] = useState(false);
    const [time, setTime] = useState(getBDTime());
    const [checkStatus, setCheckStatus] = useState(loadStatus());
    const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
    const [popup, setPopup] = useState(null); // {booking, x, y}

    useEffect(() => {
        const h = () => setIsMobile(window.innerWidth < 768);
        window.addEventListener('resize', h);
        return () => window.removeEventListener('resize', h);
    }, []);

    useEffect(() => { const t = setInterval(() => setTime(getBDTime()), 60000); return () => clearInterval(t); }, []);

    const allRooms = useMemo(() => {
        let arr = [];
        ROOMS.forEach(r => r.units.forEach(u => arr.push({room: r, unit: u, floor: getFloor(u.n)})));
        return arr.sort((a,b) => parseInt(a.unit.n) - parseInt(b.unit.n));
    }, []);

    const roomsByFloor = useMemo(() => {
        const g = {};
        FLOORS.forEach(f => g[f] = []);
        allRooms.forEach(r => g[r.floor]?.push(r));
        return g;
    }, [allRooms]);

    const fetchData = useCallback(async () => {
        setLoading(true);
        setError("");
        try {
            const res = await fetch(`${PROXY}?endpoint=bookings&propertyId=${PROPERTY}&departureFrom=${getBDDate(-7)}`);
            const data = await res.json();
            if (data.success) setBookings(data.data.filter(b => b.status !== "cancelled"));
            else setError(data.error || "Error");
        } catch(e) { setError(e.message); }
        setLoading(false);
    }, []);

    useEffect(() => { fetchData(); const i = setInterval(fetchData, 120000); return () => clearInterval(i); }, [fetchData]);

    const getBooking = useCallback((roomId, unitId, d) => bookings.find(b => b.roomId === roomId && b.unitId === unitId && d >= b.arrival && d < b.departure), [bookings]);
    const getCheckout = useCallback((roomId, unitId, d) => bookings.find(b => b.roomId === roomId && b.unitId === unitId && b.departure === d), [bookings]);
    const getCheckin = useCallback((roomId, unitId, d) => bookings.find(b => b.roomId === roomId && b.unitId === unitId && b.arrival === d), [bookings]);

    const getDays = useCallback((count) => {
        const days = [];
        const start = new Date(startDate + "T00:00:00");
        for (let i = 0; i < count; i++) {
            const d = new Date(start);
            d.setDate(d.getDate() + i);
            days.push(d.toISOString().split('T')[0]);
        }
        return days;
    }, [startDate]);

    const days = useMemo(() => getDays(calDays), [getDays, calDays]);
    const today = getBDDate();

    const toggleSelect = (room, unit, date) => {
        const key = `${room.id}-${unit.id}-${date}`;
        setSelected(s => s.find(x => x.key === key) ? s.filter(x => x.key !== key) : [...s, {key, room, unit, date}]);
    };

    const toggle = (id, type) => {
        const ns = {...checkStatus};
        const key = type === "in" ? "checkedin" : "checkedout";
        ns[id] = ns[id] === key ? null : key;
        if (!ns[id]) delete ns[id];
        setCheckStatus(ns);
        saveStatus(ns);
    };

    const showGuestPopup = (e, booking) => {
        e.stopPropagation();
        const rect = e.currentTarget.getBoundingClientRect();
        setPopup({
            booking,
            x: Math.min(rect.left, window.innerWidth - 300),
            y: rect.bottom + 10
        });
    };

    const stats = useMemo(() => {
        let occ=0, avail=0, cin=0, cout=0;
        allRooms.forEach(({room, unit}) => getBooking(room.id, unit.id, today) ? occ++ : avail++);
        bookings.forEach(b => { if(b.arrival === today) cin++; if(b.departure === today) cout++; });
        return {total: allRooms.length, occ, avail, cin, cout};
    }, [allRooms, bookings, getBooking, today]);

    const housekeeping = useMemo(() => {
        const makeup = [], dirty = [], turnover = [];
        allRooms.forEach(({room, unit}) => {
            const co = getCheckout(room.id, unit.id, today);
            const ci = getCheckin(room.id, unit.id, today);
            const stay = bookings.find(b => b.roomId === room.id && b.unitId === unit.id && b.arrival < today && b.departure > today);
            if (co && ci) turnover.push({room, unit, out: co, in: ci});
            else if (co) dirty.push({room, unit, booking: co});
            else if (stay) makeup.push({room, unit, booking: stay});
        });
        return {makeup, dirty, turnover};
    }, [allRooms, bookings, getCheckout, getCheckin, today]);

    const movements = useMemo(() => {
        const todayIn = bookings.filter(b => b.arrival === today);
        const todayOut = bookings.filter(b => b.departure === today);
        const guests = bookings.filter(b => b.arrival <= today && b.departure > today);
        return {
            pendingIn: todayIn.filter(b => checkStatus[b.id] !== "checkedin"),
            doneIn: todayIn.filter(b => checkStatus[b.id] === "checkedin"),
            pendingOut: todayOut.filter(b => checkStatus[b.id] !== "checkedout"),
            doneOut: todayOut.filter(b => checkStatus[b.id] === "checkedout"),
            guests
        };
    }, [bookings, checkStatus, today]);

    const tabs = [
        {id: "floor", label: "üè¢ By Floor"},
        {id: "category", label: "üìÅ By Category"},
        {id: "search", label: "üîç Search & Book"},
        {id: "housekeeping", label: "üßπ Housekeeping"},
        {id: "movements", label: "‚ÜîÔ∏è Movements"},
        {id: "dashboard", label: "üìä Dashboard"}
    ];

    // Status Cell Component
    const StatusBox = ({room, unit, date}) => {
        const booking = getBooking(room.id, unit.id, date);
        const checkout = getCheckout(room.id, unit.id, date);
        const checkin = getCheckin(room.id, unit.id, date);
        const isToday = date === today;
        const isSelected = selected.find(x => x.key === `${room.id}-${unit.id}-${date}`);
        
        let cls = "st-available", icon = "‚úì", text = "Available", guest = null, showInfo = false;
        
        if (checkout && checkin) {
            cls = "st-turnover"; icon = "‚¨Ü‚¨á"; text = ""; guest = checkin; showInfo = true;
        } else if (booking) {
            cls = booking.arrival === date ? "st-checkin" : "st-occupied";
            icon = booking.arrival === date ? "‚¨á" : "";
            text = booking.arrival === date ? "IN" : "";
            guest = booking; showInfo = true;
        } else if (checkout) {
            cls = "st-checkout"; icon = "‚¨Ü"; text = "OUT"; guest = checkout; showInfo = true;
        }
        
        const canSelect = !booking && !checkout;
        
        const handleClick = (e) => {
            if (showInfo && guest) {
                showGuestPopup(e, guest);
            } else if (canSelect) {
                toggleSelect(room, unit, date);
            }
        };

        return (
            <div className={`status-box ${cls} ${isToday ? 'today-col' : ''} ${isSelected ? 'selected' : ''}`} onClick={handleClick}>
                {showInfo && <div className="info-icon">i</div>}
                {icon && <span className="status-icon">{icon}</span>}
                {guest ? (
                    <>
                        <span className="guest-name">{guest.firstName}</span>
                        <span className="guest-date">‚Üí{formatDate(guest.departure).split(',')[0]}</span>
                    </>
                ) : (
                    <span className="status-text">{text}</span>
                )}
            </div>
        );
    };

    // Calendar Header
    const CalendarHeader = () => (
        <div className="cal-header-row">
            <div className="cal-header-cell room-col"></div>
            {days.map(d => (
                <div key={d} className={`cal-header-cell ${d === today ? 'today' : ''}`}>
                    <div className="day-name">{dayName(d)}</div>
                    <div className="day-num">{dayNum(d)}</div>
                </div>
            ))}
        </div>
    );

    // Room Row
    const RoomRow = ({room, unit}) => (
        <div className="room-row">
            <div className="room-label-box">
                <div className="room-num">{unit.n}</div>
                <div className="room-type">{room.short}</div>
                <div className="room-cap">üë§ {room.max}A</div>
            </div>
            {days.map(d => <StatusBox key={d} room={room} unit={unit} date={d}/>)}
        </div>
    );

    return (
        <div style={{minHeight: '100vh'}} onClick={() => setPopup(null)}>
            {/* Header */}
            <div className="header">
                <div style={{padding: '12px 16px'}}>
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px', marginBottom: '12px'}}>
                        <div>
                            <h1 style={{fontSize: '18px', fontWeight: '700'}}>üè® Miami Beach Resort</h1>
                            <p style={{fontSize: '12px', color: 'rgba(255,255,255,0.5)', marginTop: '2px'}}>{formatDate(today)} ‚Ä¢ {time} ‚Ä¢ {bookings.length} bookings</p>
                        </div>
                        <button onClick={fetchData} disabled={loading} style={{padding: '10px 20px', background: '#10b981', border: 'none', borderRadius: '8px', color: 'white', fontWeight: '600', cursor: 'pointer', fontSize: '13px'}}>
                            {loading ? '‚è≥' : 'üîÑ'} Refresh
                        </button>
                    </div>

                    {isMobile ? (
                        <select value={tab} onChange={e => setTab(e.target.value)} className="mobile-select" style={{marginBottom: '10px'}}>
                            {tabs.map(t => <option key={t.id} value={t.id}>{t.label}</option>)}
                        </select>
                    ) : (
                        <div style={{display: 'flex', gap: '6px', marginBottom: '10px', overflowX: 'auto', paddingBottom: '4px'}}>
                            {tabs.map(t => <button key={t.id} onClick={() => setTab(t.id)} className={`nav-btn ${tab === t.id ? 'active' : ''}`}>{t.label}</button>)}
                        </div>
                    )}

                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: '8px', marginBottom: '10px'}}>
                        <div className="stat-box"><div className="stat-num">{stats.total}</div><div className="stat-label">Total</div></div>
                        <div className="stat-box"><div className="stat-num" style={{color: '#10b981'}}>{stats.avail}</div><div className="stat-label">Available</div></div>
                        <div className="stat-box"><div className="stat-num" style={{color: '#ef4444'}}>{stats.occ}</div><div className="stat-label">Occupied</div></div>
                        <div className="stat-box"><div className="stat-num" style={{color: '#3b82f6'}}>{stats.cin}</div><div className="stat-label">Check-in</div></div>
                        <div className="stat-box"><div className="stat-num" style={{color: '#8b5cf6'}}>{stats.cout}</div><div className="stat-label">Check-out</div></div>
                    </div>

                    {(tab === "floor" || tab === "category") && (
                        <div style={{display: 'flex', flexWrap: 'wrap', alignItems: 'center', gap: '8px'}}>
                            <input type="date" value={startDate} onChange={e => setStartDate(e.target.value)} className="date-input"/>
                            <button onClick={() => setStartDate(getBDDate())} className={`day-btn ${startDate === getBDDate() ? 'active' : ''}`}>Today</button>
                            <div style={{width: '1px', height: '20px', background: 'rgba(255,255,255,0.1)'}}></div>
                            {[1, 3, 7, 15].map(d => <button key={d} onClick={() => setCalDays(d)} className={`day-btn ${calDays === d ? 'active' : ''}`}>{d}D</button>)}
                            <div style={{flex: 1}}></div>
                            <div className="legend">
                                <span className="legend-item"><span className="legend-dot" style={{background: '#10b981'}}></span>Available</span>
                                <span className="legend-item"><span className="legend-dot" style={{background: '#ef4444'}}></span>Occupied</span>
                                <span className="legend-item"><span className="legend-dot" style={{background: '#3b82f6'}}></span>Check-in</span>
                                <span className="legend-item"><span className="legend-dot" style={{background: '#f59e0b'}}></span>Turnover</span>
                            </div>
                        </div>
                    )}
                </div>
            </div>

            {error && <div style={{margin: '12px', padding: '12px', background: 'rgba(239,68,68,0.15)', border: '1px solid #ef4444', borderRadius: '8px', color: '#ef4444', fontSize: '13px'}}>{error}</div>}
            {loading && <div style={{display: 'flex', justifyContent: 'center', padding: '50px'}}><div className="loader"></div></div>}

            {!loading && (
                <>
                    {/* BY FLOOR */}
                    {tab === "floor" && (
                        <div className="cal-container">
                            <CalendarHeader/>
                            {FLOORS.map(floor => {
                                const rooms = roomsByFloor[floor];
                                if (!rooms?.length) return null;
                                return (
                                    <div key={floor} className="floor-section">
                                        <div className="floor-header">
                                            <span className="floor-title">üè¢ {floorName(floor)} Floor</span>
                                            <span className="floor-count">{rooms.length} rooms</span>
                                        </div>
                                        {rooms.map(({room, unit}) => <RoomRow key={`${room.id}-${unit.id}`} room={room} unit={unit}/>)}
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* BY CATEGORY */}
                    {tab === "category" && (
                        <div className="cal-container">
                            <CalendarHeader/>
                            {ROOMS.map(roomType => (
                                <div key={roomType.id} className="floor-section">
                                    <div className="floor-header">
                                        <span className="floor-title">üìÅ {roomType.name}</span>
                                        <span className="floor-count">{roomType.units.length} ‚Ä¢ {roomType.max}A</span>
                                    </div>
                                    {roomType.units.map(unit => <RoomRow key={`${roomType.id}-${unit.id}`} room={roomType} unit={unit}/>)}
                                </div>
                            ))}
                        </div>
                    )}

                    {/* SEARCH & BOOK */}
                    {tab === "search" && (
                        <div className="search-section">
                            <h2 style={{fontSize: '18px', fontWeight: '600', marginBottom: '12px'}}>üîç Search & Book</h2>
                            <div style={{display: 'flex', flexWrap: 'wrap', gap: '10px', alignItems: 'center', marginBottom: '16px'}}>
                                <div>
                                    <label style={{fontSize: '11px', color: 'rgba(255,255,255,0.5)', display: 'block', marginBottom: '4px'}}>Check-in</label>
                                    <input type="date" value={startDate} onChange={e => setStartDate(e.target.value)} className="date-input"/>
                                </div>
                                <div>
                                    <label style={{fontSize: '11px', color: 'rgba(255,255,255,0.5)', display: 'block', marginBottom: '4px'}}>View Days</label>
                                    <div style={{display: 'flex', gap: '4px'}}>
                                        {[1, 3, 7, 15].map(d => <button key={d} onClick={() => setCalDays(d)} className={`day-btn ${calDays === d ? 'active' : ''}`}>{d}</button>)}
                                    </div>
                                </div>
                            </div>
                            <h3 style={{fontSize: '14px', color: 'rgba(255,255,255,0.7)', marginBottom: '12px'}}>Available Rooms for {formatDate(startDate)}</h3>
                            <div className="search-grid">
                                {allRooms.filter(({room, unit}) => !getBooking(room.id, unit.id, startDate)).map(({room, unit}) => {
                                    const isSelected = selected.find(x => x.room.id === room.id && x.unit.id === unit.id);
                                    return (
                                        <div key={`${room.id}-${unit.id}`} className={`search-card ${isSelected ? 'selected' : ''}`}
                                             onClick={() => toggleSelect(room, unit, startDate)}>
                                            <div className="search-room">{unit.n}</div>
                                            <div className="search-type">{room.short}</div>
                                            <div style={{fontSize: '10px', opacity: 0.7, marginTop: '4px'}}>üë§ {room.max}A</div>
                                        </div>
                                    );
                                })}
                            </div>
                            {allRooms.filter(({room, unit}) => !getBooking(room.id, unit.id, startDate)).length === 0 && (
                                <div style={{textAlign: 'center', padding: '40px', color: 'rgba(255,255,255,0.4)'}}>No rooms available</div>
                            )}
                        </div>
                    )}

                    {/* HOUSEKEEPING */}
                    {tab === "housekeeping" && (
                        <div style={{padding: '16px'}}>
                            <h2 style={{fontSize: '18px', fontWeight: '600', marginBottom: '16px'}}>üßπ Housekeeping</h2>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px'}}>
                                <div className="hk-section">
                                    <h3 style={{color: '#0ea5e9', marginBottom: '12px', fontSize: '14px'}}>üõèÔ∏è Make-up ({housekeeping.makeup.length})</h3>
                                    {housekeeping.makeup.map(({room, unit, booking}) => (
                                        <div key={`${room.id}-${unit.id}`} className="hk-card hk-makeup">
                                            <div className="hk-room">{unit.n}</div>
                                            <div><div style={{fontWeight: '600'}}>{booking.firstName}</div><div style={{fontSize: '11px', opacity: 0.8}}>{room.short}</div></div>
                                        </div>
                                    ))}
                                    {!housekeeping.makeup.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '24px'}}>No rooms</div>}
                                </div>
                                <div className="hk-section">
                                    <h3 style={{color: '#f97316', marginBottom: '12px', fontSize: '14px'}}>üßΩ Dirty ({housekeeping.dirty.length})</h3>
                                    {housekeeping.dirty.map(({room, unit, booking}) => (
                                        <div key={`${room.id}-${unit.id}`} className="hk-card hk-dirty">
                                            <div className="hk-room">{unit.n}</div>
                                            <div><div style={{fontWeight: '600'}}>{booking.firstName}</div><div style={{fontSize: '11px', opacity: 0.8}}>{room.short}</div></div>
                                        </div>
                                    ))}
                                    {!housekeeping.dirty.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '24px'}}>No rooms</div>}
                                </div>
                                <div className="hk-section">
                                    <h3 style={{color: '#a855f7', marginBottom: '12px', fontSize: '14px'}}>üîÑ Turnover ({housekeeping.turnover.length})</h3>
                                    {housekeeping.turnover.map(({room, unit, out, in: ci}) => (
                                        <div key={`${room.id}-${unit.id}`} className="hk-card hk-turnover">
                                            <div className="hk-room">{unit.n}</div>
                                            <div><div style={{fontWeight: '600'}}>{out.firstName} ‚Üí {ci.firstName}</div><div style={{fontSize: '11px', opacity: 0.8}}>{room.short}</div></div>
                                        </div>
                                    ))}
                                    {!housekeeping.turnover.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '24px'}}>No rooms</div>}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MOVEMENTS */}
                    {tab === "movements" && (
                        <div style={{padding: '16px'}}>
                            <h2 style={{fontSize: '18px', fontWeight: '600', marginBottom: '16px'}}>‚ÜîÔ∏è Movements</h2>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(260px, 1fr))', gap: '12px', marginBottom: '20px'}}>
                                <div className="hk-section">
                                    <h3 style={{color: '#3b82f6', marginBottom: '10px', fontSize: '14px'}}>‚¨áÔ∏è Pending In ({movements.pendingIn.length})</h3>
                                    {movements.pendingIn.map(b => {
                                        const {num, room} = getRoomInfo(b.roomId, b.unitId);
                                        return (
                                            <div key={b.id} className="mv-card">
                                                <div><div style={{fontWeight: '600'}}>{b.firstName}</div><div style={{fontSize: '12px', color: 'rgba(255,255,255,0.5)'}}>Room {num}</div></div>
                                                <button className="mv-btn mv-btn-pending" onClick={() => toggle(b.id, "in")}>‚úì</button>
                                            </div>
                                        );
                                    })}
                                    {!movements.pendingIn.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '20px'}}>None</div>}
                                </div>
                                <div className="hk-section">
                                    <h3 style={{color: '#10b981', marginBottom: '10px', fontSize: '14px'}}>‚úÖ Checked In ({movements.doneIn.length})</h3>
                                    {movements.doneIn.map(b => {
                                        const {num} = getRoomInfo(b.roomId, b.unitId);
                                        return (
                                            <div key={b.id} className="mv-card">
                                                <div><div style={{fontWeight: '600'}}>{b.firstName}</div><div style={{fontSize: '12px', color: 'rgba(255,255,255,0.5)'}}>Room {num}</div></div>
                                                <button className="mv-btn mv-btn-done" onClick={() => toggle(b.id, "in")}>‚Ü©</button>
                                            </div>
                                        );
                                    })}
                                    {!movements.doneIn.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '20px'}}>None</div>}
                                </div>
                                <div className="hk-section">
                                    <h3 style={{color: '#8b5cf6', marginBottom: '10px', fontSize: '14px'}}>‚¨ÜÔ∏è Pending Out ({movements.pendingOut.length})</h3>
                                    {movements.pendingOut.map(b => {
                                        const {num} = getRoomInfo(b.roomId, b.unitId);
                                        return (
                                            <div key={b.id} className="mv-card">
                                                <div><div style={{fontWeight: '600'}}>{b.firstName}</div><div style={{fontSize: '12px', color: 'rgba(255,255,255,0.5)'}}>Room {num}</div></div>
                                                <button className="mv-btn mv-btn-pending" onClick={() => toggle(b.id, "out")}>‚úì</button>
                                            </div>
                                        );
                                    })}
                                    {!movements.pendingOut.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '20px'}}>None</div>}
                                </div>
                                <div className="hk-section">
                                    <h3 style={{color: '#f59e0b', marginBottom: '10px', fontSize: '14px'}}>üëã Checked Out ({movements.doneOut.length})</h3>
                                    {movements.doneOut.map(b => {
                                        const {num} = getRoomInfo(b.roomId, b.unitId);
                                        return (
                                            <div key={b.id} className="mv-card">
                                                <div><div style={{fontWeight: '600'}}>{b.firstName}</div><div style={{fontSize: '12px', color: 'rgba(255,255,255,0.5)'}}>Room {num}</div></div>
                                                <button className="mv-btn mv-btn-done" onClick={() => toggle(b.id, "out")}>‚Ü©</button>
                                            </div>
                                        );
                                    })}
                                    {!movements.doneOut.length && <div style={{color: 'rgba(255,255,255,0.3)', textAlign: 'center', padding: '20px'}}>None</div>}
                                </div>
                            </div>
                            <div className="hk-section">
                                <h3 style={{marginBottom: '12px', fontSize: '14px'}}>üè† Current Guests ({movements.guests.length})</h3>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(140px, 1fr))', gap: '10px'}}>
                                    {movements.guests.map(b => {
                                        const {num, room} = getRoomInfo(b.roomId, b.unitId);
                                        return (
                                            <div key={b.id} style={{background: 'rgba(255,255,255,0.05)', borderRadius: '8px', padding: '12px'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between'}}><span style={{fontWeight: '600', fontSize: '13px'}}>{b.firstName}</span><span style={{color: '#3b82f6', fontWeight: '700'}}>{num}</span></div>
                                                <div style={{fontSize: '10px', color: 'rgba(255,255,255,0.4)', marginTop: '2px'}}>{room?.short}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* DASHBOARD */}
                    {tab === "dashboard" && (
                        <div style={{padding: '16px'}}>
                            <h2 style={{fontSize: '18px', fontWeight: '600', marginBottom: '16px'}}>üìä Dashboard</h2>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px'}}>
                                <div className="hk-section">
                                    <h3 style={{marginBottom: '14px', fontSize: '14px'}}>Occupancy by Type</h3>
                                    {ROOMS.map(r => {
                                        const booked = r.units.filter(u => getBooking(r.id, u.id, today)).length;
                                        const pct = Math.round(booked / r.units.length * 100);
                                        return (
                                            <div key={r.id} style={{marginBottom: '12px'}}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '12px', marginBottom: '4px'}}>
                                                    <span>{r.short}</span><span style={{color: 'rgba(255,255,255,0.5)'}}>{booked}/{r.units.length}</span>
                                                </div>
                                                <div style={{height: '8px', background: 'rgba(255,255,255,0.1)', borderRadius: '4px'}}>
                                                    <div style={{height: '100%', width: pct+'%', background: '#10b981', borderRadius: '4px'}}></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="hk-section">
                                    <h3 style={{marginBottom: '14px', fontSize: '14px'}}>Occupancy by Floor</h3>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '10px'}}>
                                        {FLOORS.map(f => {
                                            const rooms = roomsByFloor[f] || [];
                                            const booked = rooms.filter(({room, unit}) => getBooking(room.id, unit.id, today)).length;
                                            const pct = rooms.length ? Math.round(booked / rooms.length * 100) : 0;
                                            return (
                                                <div key={f} style={{background: 'rgba(255,255,255,0.05)', borderRadius: '10px', padding: '14px', textAlign: 'center'}}>
                                                    <div style={{color: 'rgba(255,255,255,0.5)', fontSize: '11px'}}>Floor {f}</div>
                                                    <div style={{fontSize: '26px', fontWeight: '700', color: pct > 70 ? '#ef4444' : pct > 40 ? '#f59e0b' : '#10b981'}}>{pct}%</div>
                                                    <div style={{fontSize: '10px', color: 'rgba(255,255,255,0.4)'}}>{booked}/{rooms.length}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            )}

            {/* Guest Info Popup */}
            {popup && (
                <div className="guest-popup" style={{left: popup.x, top: popup.y}} onClick={e => e.stopPropagation()}>
                    <div className="popup-header">
                        <div>
                            <div className="popup-title">{popup.booking.firstName} {popup.booking.lastName || ''}</div>
                            <div className="popup-room">Room {getRoomInfo(popup.booking.roomId, popup.booking.unitId).num}</div>
                        </div>
                        <button className="popup-close" onClick={() => setPopup(null)}>√ó</button>
                    </div>
                    <div className="popup-row"><span className="popup-label">Phone</span><span className="popup-value">{popup.booking.mobile || 'N/A'}</span></div>
                    <div className="popup-row"><span className="popup-label">Email</span><span className="popup-value">{popup.booking.email || 'N/A'}</span></div>
                    <div className="popup-row"><span className="popup-label">Check-in</span><span className="popup-value">{formatDate(popup.booking.arrival)}</span></div>
                    <div className="popup-row"><span className="popup-label">Check-out</span><span className="popup-value">{formatDate(popup.booking.departure)}</span></div>
                    <div className="popup-row"><span className="popup-label">Total</span><span className="popup-value">‡ß≥{popup.booking.price || 0}</span></div>
                    <div className="popup-row"><span className="popup-label">Due</span><span className={`popup-value ${(popup.booking.price - (popup.booking.deposit || 0)) > 0 ? 'due' : 'paid'}`}>‡ß≥{Math.max(0, (popup.booking.price || 0) - (popup.booking.deposit || 0))}</span></div>
                </div>
            )}

            {/* Floating Book Button */}
            {selected.length > 0 && (
                <div style={{position: 'fixed', bottom: '20px', left: '12px', right: '12px', zIndex: 100, maxWidth: '500px', margin: '0 auto'}}>
                    <button onClick={() => setShowModal(true)} style={{width: '100%', padding: '16px', background: 'linear-gradient(135deg, #10b981, #059669)', border: 'none', borderRadius: '12px', color: 'white', fontWeight: '700', fontSize: '15px', cursor: 'pointer', boxShadow: '0 6px 25px rgba(16,185,129,0.4)', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px'}}>
                        ‚ûï Book {selected.length} Room{selected.length > 1 ? 's' : ''}
                        <span onClick={e => {e.stopPropagation(); setSelected([]);}} style={{marginLeft: 'auto', background: 'rgba(255,255,255,0.2)', borderRadius: '50%', width: '28px', height: '28px', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>‚úï</span>
                    </button>
                </div>
            )}

            {showModal && <BookingModal selected={selected} onClose={() => {setShowModal(false); setSelected([]); fetchData();}}/>}
        </div>
    );
}

function BookingModal({selected, onClose}) {
    const [form, setForm] = useState({guests: [{name: ""}], phones: [""], email: "", nid: "", checkIn: getBDDate(), checkOut: getBDDate(1)});
    const [status, setStatus] = useState("");

    const add = (f) => form[f].length < 3 && setForm({...form, [f]: [...form[f], f === 'guests' ? {name: ""} : ""]});
    const upd = (f, i, v) => { const a = [...form[f]]; f === 'guests' ? a[i].name = v : a[i] = v; setForm({...form, [f]: a}); };
    const rem = (f, i) => form[f].length > 1 && setForm({...form, [f]: form[f].filter((_, idx) => idx !== i)});

    const submit = async (e) => {
        e.preventDefault();
        setStatus("loading");
        try {
            const names = form.guests.map(g => g.name).filter(Boolean).join(", ");
            const phones = form.phones.filter(Boolean).join(", ");
            const data = selected.map(s => ({
                propertyId: PROPERTY, roomId: s.room.id, unitId: s.unit.id,
                arrival: form.checkIn, departure: form.checkOut,
                numAdult: s.room.max, status: "confirmed",
                firstName: names, email: form.email || "default",
                mobile: phones, custom4: form.nid || "default",
                referer: "miami_frontdesk"
            }));
            const res = await fetch(PROXY + "?endpoint=bookings&action=write", {method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify(data)});
            const result = await res.json();
            if (result.success) { setStatus("success"); setTimeout(onClose, 1500); }
            else setStatus("error: " + (result.error || "Failed"));
        } catch(e) { setStatus("error: " + e.message); }
    };

    if (status === "success") return (
        <div style={{position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 200}}>
            <div style={{background: '#1e2128', borderRadius: '16px', padding: '40px', textAlign: 'center'}}>
                <div style={{fontSize: '48px', marginBottom: '12px'}}>‚úÖ</div>
                <div style={{fontSize: '18px', fontWeight: '700'}}>Booking Created!</div>
            </div>
        </div>
    );

    const inputStyle = {width: '100%', padding: '10px 12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px', color: '#fff', fontSize: '13px'};

    return (
        <div style={{position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '16px', zIndex: 200, overflowY: 'auto'}}>
            <div style={{background: '#1e2128', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '16px', padding: '24px', width: '100%', maxWidth: '400px'}}>
                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px'}}>
                    <h3 style={{fontSize: '18px', fontWeight: '700'}}>‚ûï New Booking</h3>
                    <button onClick={onClose} style={{background: 'none', border: 'none', color: 'rgba(255,255,255,0.5)', fontSize: '24px', cursor: 'pointer'}}>√ó</button>
                </div>
                <div style={{display: 'flex', flexWrap: 'wrap', gap: '6px', marginBottom: '20px'}}>
                    {selected.map(s => <span key={s.key} style={{padding: '6px 12px', background: '#10b981', borderRadius: '6px', fontSize: '13px', fontWeight: '600'}}>{s.unit.n}</span>)}
                </div>
                <form onSubmit={submit}>
                    <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '14px'}}>
                        <div><label style={{fontSize: '11px', color: 'rgba(255,255,255,0.5)', display: 'block', marginBottom: '4px'}}>Check-in</label><input type="date" required value={form.checkIn} onChange={e => setForm({...form, checkIn: e.target.value})} style={inputStyle}/></div>
                        <div><label style={{fontSize: '11px', color: 'rgba(255,255,255,0.5)', display: 'block', marginBottom: '4px'}}>Check-out</label><input type="date" required min={form.checkIn} value={form.checkOut} onChange={e => setForm({...form, checkOut: e.target.value})} style={inputStyle}/></div>
                    </div>
                    <div style={{marginBottom: '14px'}}>
                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '6px'}}><label style={{fontSize: '11px', color: 'rgba(255,255,255,0.5)'}}>Guests *</label>{form.guests.length < 3 && <button type="button" onClick={() => add('guests')} style={{background: 'none', border: 'none', color: '#10b981', fontSize: '11px', cursor: 'pointer'}}>+ Add</button>}</div>
                        {form.guests.map((g, i) => (
                            <div key={i} style={{display: 'flex', gap: '8px', marginBottom: '8px'}}>
                                <input type="text" required value={g.name} onChange={e => upd('guests', i, e.target.value)} placeholder={`Guest ${i+1}`} style={{...inputStyle, flex: 1}}/>
                                {form.guests.length > 1 && <button type="button" onClick={() => rem('guests', i)} style={{background: 'none', border: 'none', color: '#ef4444', fontSize: '18px', cursor: 'pointer'}}>√ó</button>}
                            </div>
                        ))}
                    </div>
                    <div style={{marginBottom: '14px'}}>
                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '6px'}}><label style={{fontSize: '11px', color: 'rgba(255,255,255,0.5)'}}>Phone *</label>{form.phones.length < 3 && <button type="button" onClick={() => add('phones')} style={{background: 'none', border: 'none', color: '#10b981', fontSize: '11px', cursor: 'pointer'}}>+ Add</button>}</div>
                        {form.phones.map((p, i) => (
                            <div key={i} style={{display: 'flex', gap: '8px', marginBottom: '8px'}}>
                                <input type="tel" required value={p} onChange={e => upd('phones', i, e.target.value)} placeholder={`Phone ${i+1}`} style={{...inputStyle, flex: 1}}/>
                                {form.phones.length > 1 && <button type="button" onClick={() => rem('phones', i)} style={{background: 'none', border: 'none', color: '#ef4444', fontSize: '18px', cursor: 'pointer'}}>√ó</button>}
                            </div>
                        ))}
                    </div>
                    <input type="email" value={form.email} onChange={e => setForm({...form, email: e.target.value})} placeholder="Email (optional)" style={{...inputStyle, marginBottom: '10px'}}/>
                    <input type="text" value={form.nid} onChange={e => setForm({...form, nid: e.target.value})} placeholder="NID (optional)" style={{...inputStyle, marginBottom: '16px'}}/>
                    {status.startsWith("error") && <div style={{padding: '10px', background: 'rgba(239,68,68,0.15)', border: '1px solid #ef4444', borderRadius: '8px', color: '#ef4444', fontSize: '12px', marginBottom: '14px'}}>{status}</div>}
                    <div style={{display: 'flex', gap: '10px'}}>
                        <button type="button" onClick={onClose} style={{flex: 1, padding: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px', color: '#fff', fontWeight: '600', cursor: 'pointer'}}>Cancel</button>
                        <button type="submit" disabled={status === "loading"} style={{flex: 1, padding: '12px', background: '#10b981', border: 'none', borderRadius: '8px', color: 'white', fontWeight: '700', cursor: 'pointer', opacity: status === "loading" ? 0.6 : 1}}>{status === "loading" ? "..." : "Book"}</button>
                    </div>
                </form>
            </div>
        </div>
    );
}

ReactDOM.render(<App/>, document.getElementById("root"));
</script>
</body>
</html>
